---
- name: Ensure Docker Compose is up for Elasticsearch Logs
  shell: /usr/local/bin/docker-compose -f /home/astraydev/candhis_api/docker-compose.yml up -d elasticsearch_logs
  args:
    chdir: /home/astraydev/candhis_api
  tags:
    - logs

- name: Ensure Docker Compose is up for Fluentd
  shell: /usr/local/bin/docker-compose -f /home/astraydev/candhis_api/docker-compose.yml up -d fluentd
  args:
    chdir: /home/astraydev/candhis_api
  tags:
    - logs

- name: Ensure Docker Compose is up for Kibana Logs
  shell: /usr/local/bin/docker-compose -f /home/astraydev/candhis_api/docker-compose.yml up -d kibana_logs
  args:
    chdir: /home/astraydev/candhis_api
  tags:
    - logs

- name: Install ufw if not present
  apt:
    name: ufw
    state: present
  tags:
    - logs

- name: Ensure ufw is enabled
  ufw:
    state: enabled

- name: Ensure port 5601 is open in the firewall
  ufw:
    rule: allow
    port: "5601"
    proto: tcp
    comment: "Allow Kibana access"
  tags:
    - logs

- name: Open port 5601 for Kibana in iptables
  iptables:
    chain: INPUT
    protocol: tcp
    destination_port: 5601
    jump: ACCEPT
  tags:
    - logs